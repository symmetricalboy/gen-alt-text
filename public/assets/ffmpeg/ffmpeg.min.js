/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/ffmpeg@0.0.4/lib/ffmpeg.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var when=require("when"),fs=require("fs"),errors=require("./errors"),utils=require("./utils"),configs=require("./configs"),video=require("./video"),ffmpeg=function(){var e=function(e,r){var o=[];return o.push(function(e){var r=when.defer(),o={modules:new Array,encode:new Array,decode:new Array};return utils.exec(["ffmpeg","-formats","2>&1"],e,(function(e,t,i){var n=/configuration:(.*)/.exec(t);if(n){var s=n[1].match(/--enable-([a-zA-Z0-9\-]+)/g);for(var a in s)o.modules.push(/--enable-([a-zA-Z0-9\-]+)/.exec(s[a])[1])}var l=t.match(/ (DE|D|E) (.*) {1,} (.*)/g);for(var c in l){var u=/ (DE|D|E) (.*) {1,} (.*)/.exec(l[c]);if(u){var d=u[1].replace(/\s/g,""),p=u[2].replace(/\s/g,"");"D"!=d&&"DE"!=d||o.decode.push(p),"E"!=d&&"DE"!=d||o.encode.push(p)}}r.resolve(o)})),r.promise}(r)),o.push(function(e,r){var o=when.defer();return utils.exec(["ffmpeg","-i",e,"2>&1"],r,(function(e,r,t){var i=/from \'(.*)\'/.exec(r)||[],n=/(INAM|title)\s+:\s(.+)/.exec(r)||[],s=/artist\s+:\s(.+)/.exec(r)||[],a=/album\s+:\s(.+)/.exec(r)||[],l=/track\s+:\s(.+)/.exec(r)||[],c=/date\s+:\s(.+)/.exec(r)||[],u=null!==/start: 0.000000/.exec(r),d=/Duration: (([0-9]+):([0-9]{2}):([0-9]{2}).([0-9]+))/.exec(r)||[],p=/Input #0, ([a-zA-Z0-9]+),/.exec(r)||[],v=/bitrate: ([0-9]+) kb\/s/.exec(r)||[],f=/Stream #([0-9\.]+)([a-z0-9\(\)\[\]]*)[:] Video/.exec(r)||[],x=/Video: ([\w]+)/.exec(r)||[],h=/(([0-9]{2,5})x([0-9]{2,5}))/.exec(r)||[],g=/[SP]AR ([0-9\:]+)/.exec(r)||[],w=/DAR ([0-9\:]+)/.exec(r)||[],m=/([0-9\.]+) (fps|tb\(r\))/.exec(r)||[],y=/Stream #([0-9\.]+)([a-z0-9\(\)\[\]]*)[:] Audio/.exec(r)||[],b=/Audio: ([\w]+)/.exec(r)||[],A=/([0-9]+) Hz/i.exec(r)||[],I=/Audio:.* (stereo|mono)/.exec(r)||[],S=/Audio:.* ([0-9]+) kb\/s/.exec(r)||[],q=/rotate[\s]+:[\s]([\d]{2,3})/.exec(r)||[],E={filename:i[1]||"",title:n[2]||"",artist:s[1]||"",album:a[1]||"",track:l[1]||"",date:c[1]||"",synched:u,duration:{raw:d[1]||"",seconds:d[1]?utils.durationToSeconds(d[1]):0},video:{container:p[1]||"",bitrate:v.length>1?parseInt(v[1],10):0,stream:f.length>1?parseFloat(f[1]):0,codec:x[1]||"",resolution:{w:h.length>2?parseInt(h[2],10):0,h:h.length>3?parseInt(h[3],10):0},resolutionSquare:{},aspect:{},rotate:q.length>1?parseInt(q[1],10):0,fps:m.length>1?parseFloat(m[1]):0},audio:{codec:b[1]||"",bitrate:S[1]||"",sample_rate:A.length>1?parseInt(A[1],10):0,stream:y.length>1?parseFloat(y[1]):0,channels:{raw:I[1]||"",value:I.length>0?{stereo:2,mono:1}[I[1]]||0:""}}};if(w.length>0){var D=w[1].split(":");E.video.aspect.x=parseInt(D[0],10),E.video.aspect.y=parseInt(D[1],10),E.video.aspect.string=w[1],E.video.aspect.value=parseFloat(E.video.aspect.x/E.video.aspect.y)}else if(E.video.resolution.w>0){var _=utils.gcd(E.video.resolution.w,E.video.resolution.h);E.video.aspect.x=E.video.resolution.w/_,E.video.aspect.y=E.video.resolution.h/_,E.video.aspect.string=E.video.aspect.x+":"+E.video.aspect.y,E.video.aspect.value=parseFloat(E.video.aspect.x/E.video.aspect.y)}if(g.length>0){E.video.pixelString=g[1];var z=g[1].split(":");E.video.pixel=parseFloat(parseInt(z[0],10)/parseInt(z[1],10))}else 0!==E.video.resolution.w?(E.video.pixelString="1:1",E.video.pixel=1):(E.video.pixelString="",E.video.pixel=0);1===E.video.pixel&&0===E.video.pixel||(E.video.pixel>1?(E.video.resolutionSquare.w=parseInt(E.video.resolution.w*E.video.pixel,10),E.video.resolutionSquare.h=E.video.resolution.h):(E.video.resolutionSquare.w=E.video.resolution.w,E.video.resolutionSquare.h=parseInt(E.video.resolution.h/E.video.pixel,10))),o.resolve(E)})),o.promise}(e,r)),when.all(o)};return function(r){if(0==r.length||null==r[0])throw errors.renderError("empty_input_filepath");if("string"!=typeof r[0])throw errors.renderError("input_filepath_must_be_string");var o=r[0];if(!fs.existsSync(o))throw errors.renderError("fileinput_not_exist");for(var t=new configs,i=null,n=1;n<r.length;n++)switch(typeof r[n]){case"object":utils.mergeObject(t,r[n]);break;case"function":i=r[n]}var s="function"!=typeof i?when.defer():{promise:null};return when(e(o,t),(function(e){"function"==typeof i?i(null,new video(o,t,e[0],e[1])):s.resolve(new video(o,t,e[0],e[1]))}),(function(e){"function"==typeof i?i(e,null):s.reject(e)})),s.promise}.call(this,arguments)};module.exports=ffmpeg;
//# sourceMappingURL=/sm/6ac62f86b0805610d5df1770acdaa05cc166663db1dfffae9b0ecba9efbe42ac.map