var bskyaltgenerator=function(){"use strict";var U=Object.defineProperty;var G=(v,h,x)=>h in v?U(v,h,{enumerable:!0,configurable:!0,writable:!0,value:x}):v[h]=x;var y=(v,h,x)=>G(v,typeof h!="symbol"?h+"":h,x);var q,B;function v(l){return l}const h={matches:["*://*.bsky.app/*"],main(){if(console.log("Bluesky Alt Text Generator loaded"),typeof window>"u"||typeof document>"u")return;const t=['textarea[aria-label="Alt text"]','textarea[placeholder*="alt"]','textarea[placeholder*="Alt"]','textarea[data-testid*="alt"]','[role="textbox"][aria-label*="alt" i]'].join(","),n="gemini-alt-text-button";let r={autoMode:!1,showToasts:!0};const d={storage:{sync:{get:(o,i)=>{var a;try{(a=chrome==null?void 0:chrome.storage)!=null&&a.sync?chrome.storage.sync.get(o,i):(console.warn("Chrome storage API not available, using default values"),i({}))}catch(e){console.error("Error accessing chrome.storage.sync.get:",e),i({})}},set:o=>{var i;try{(i=chrome==null?void 0:chrome.storage)!=null&&i.sync?chrome.storage.sync.set(o):console.warn("Chrome storage API not available, cannot save settings")}catch(a){console.error("Error accessing chrome.storage.sync.set:",a)}}}},runtime:{connect:o=>{var i;try{if((i=chrome==null?void 0:chrome.runtime)!=null&&i.connect)return chrome.runtime.connect(o);throw console.error("Chrome runtime API not available"),new Error("Chrome runtime API not available")}catch(a){throw console.error("Error connecting to background script:",a),a}},onChanged:{addListener:o=>{var i;try{(i=chrome==null?void 0:chrome.storage)!=null&&i.onChanged?chrome.storage.onChanged.addListener(o):console.warn("Chrome storage.onChanged API not available")}catch(a){console.error("Error adding onChanged listener:",a)}}}}};d.storage.sync.get(["autoMode","showToasts"],o=>{o.autoMode!==void 0&&(r.autoMode=o.autoMode),o.showToasts!==void 0&&(r.showToasts=o.showToasts),console.log("Loaded config:",r)}),d.runtime.onChanged.addListener(o=>{o.autoMode&&(r.autoMode=o.autoMode.newValue),o.showToasts&&(r.showToasts=o.showToasts.newValue),console.log("Updated config:",r)});const f=(o,i="info",a=5e3)=>{let e=document.getElementById("gemini-toast-container");e||(e=document.createElement("div"),e.id="gemini-toast-container",e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="10000",e.style.display="flex",e.style.flexDirection="column",e.style.gap="10px",document.body.appendChild(e));const s=document.createElement("div");s.style.padding="12px 16px",s.style.borderRadius="6px",s.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)",s.style.margin="5px",s.style.minWidth="200px",s.style.color="#ffffff",s.style.fontSize="14px",s.style.transition="all 0.3s ease",i==="success"?s.style.backgroundColor="#1da882":i==="error"?s.style.backgroundColor="#e53935":i==="warning"?s.style.backgroundColor="#f59f0b":s.style.backgroundColor="#007eda",s.textContent=o;const c=document.createElement("span");c.textContent="×",c.style.marginLeft="8px",c.style.cursor="pointer",c.style.float="right",c.style.fontWeight="bold",c.onclick=()=>{e.removeChild(s)},s.appendChild(c),e.appendChild(s),setTimeout(()=>{e.contains(s)&&e.removeChild(s)},a)},I=o=>o.querySelector('img[alt="Image preview"], img[data-testid="image-preview"], img:not([alt="avatar"])')||o.querySelector('video[data-testid="video-preview"], video')||o.querySelector(".css-175oi2r img, .image-preview img")||Array.from(o.querySelectorAll("img")).find(a=>a.src&&!a.src.includes("avatar")&&!a.src.includes("logo")&&a.width>50);function p(o){var k,N;if(console.log("addGenerateButton called for textarea:",o),o.dataset.geminiButtonAdded==="true"){console.log("Button already added to this textarea, skipping.");return}let i=o.closest('[data-testid="composer"], [role="dialog"], .css-175oi2r');if(i?console.log("Found container via closest():",i):(i=(N=(k=o.parentElement)==null?void 0:k.parentElement)==null?void 0:N.parentElement,console.log("Using fallback container:",i)),!i){console.error("Could not find a suitable container for the button near textarea:",o);return}if(i.querySelector(`#${n}`)){console.log("Button already exists in this container, skipping.");return}const a=document.createElement("div");a.style.display="flex",a.style.alignItems="center",a.style.gap="8px",a.style.marginLeft="8px";const e=document.createElement("button");e.id=n,e.title="Generate Alt Text",e.innerHTML=`
        <svg width="20" height="20" viewBox="-5 -10 128 128" xmlns="http://www.w3.org/2000/svg">
          <path d="M 35.746,4 C 20.973,4 9,15.973 9,30.746 V 77.254 C 9,92.027 20.973,104 35.746,104 H 82.254 C 97.027,104 109,92.027 109,77.254 V 30.746 C 109,15.973 97.027,4 82.254,4 Z m -19.77,26.746 c 0,-10.918 8.8516,-19.77 19.77,-19.77 h 46.508 c 10.918,0 19.77,8.8516 19.77,19.77 v 46.508 c 0,10.918 -8.8516,19.77 -19.77,19.77 H 35.746 c -10.918,0 -19.77,-8.8516 -19.77,-19.77 z m 45.609,0.37891 c -1.082,-2.1055 -4.0898,-2.1055 -5.1719,0 l -4.3242,8.4219 c -1.668,3.2383 -4.3047,5.875 -7.543,7.543 l -8.4219,4.3242 c -2.1055,1.082 -2.1055,4.0898 0,5.1719 l 8.4219,4.3242 c 3.2383,1.668 5.875,4.3047 7.543,7.543 l 4.3242,8.4219 c 1.082,2.1055 4.0898,2.1055 5.1719,0 l 4.3242,-8.4219 c 1.668,-3.2383 4.3047,-5.875 7.543,-7.543 l 8.4219,-4.3242 c 2.1055,-1.082 2.1055,-4.0898 0,-5.1719 l -8.4219,-4.3242 c -3.2383,-1.668 -5.875,-4.3047 -7.543,-7.543 z" 
             fill="#323248" stroke="none" />
        </svg>
      `,e.style.marginLeft="8px",e.style.padding="4px",e.style.cursor="pointer",e.style.border="1px solid #ccc",e.style.borderRadius="4px",e.style.backgroundColor="#f0f0f0",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.setProperty("visibility","visible","important"),e.style.setProperty("z-index","9999","important"),e.style.setProperty("position","relative","important"),console.log("Button element created:",e);const s=e.innerHTML,c=document.createElement("label");c.className="gemini-auto-toggle",c.title="Auto-generate alt text when media is added",c.style.display="flex",c.style.alignItems="center",c.style.fontSize="12px",c.style.cursor="pointer";const g=document.createElement("input");g.type="checkbox",g.style.margin="0 4px 0 0",g.checked=r.autoMode,g.addEventListener("change",u=>{r.autoMode=u.target.checked,d.storage.sync.set({autoMode:r.autoMode})}),c.appendChild(g),c.appendChild(document.createTextNode("Auto")),a.appendChild(e),a.appendChild(c);const L=async()=>{e.innerHTML="",e.textContent="Connecting...",e.disabled=!0;const u=I(i);if(console.log("Media element found:",u),!u||!u.src){console.error("Could not find media element or its src."),e.textContent="Error: No Media",setTimeout(()=>{e.textContent="",e.innerHTML=s,e.disabled=!1},2e3);return}const E=u.src,D=u.tagName.toLowerCase()==="video";console.log(`${D?"Video":"Image"} URL:`,E);try{console.log("Establishing connection to background script...");const T=d.runtime.connect({name:"altTextGenerator"});console.log("Connection established."),e.textContent="Generating...",T.onMessage.addListener(b=>{console.log("Message received from background via port:",b),b.altText?(o.value=b.altText,o.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),console.log("Alt text inserted."),e.textContent="✓ Done",r.showToasts&&f("Alt text generated! Please review for accuracy before posting.","success"),setTimeout(()=>{e.textContent="",e.innerHTML=s,e.disabled=!1},1500)):b.error?(console.error("Error generating alt text:",b.error),e.textContent=`Error: ${b.error.substring(0,20)}...`,r.showToasts&&f(`Error: ${b.error}`,"error"),setTimeout(()=>{e.textContent="",e.innerHTML=s,e.disabled=!1},3e3)):(console.error("Received unexpected message format from background:",b),e.textContent="Msg Format Error",setTimeout(()=>{e.textContent="",e.innerHTML=s,e.disabled=!1},2e3)),T.disconnect()}),T.onDisconnect.addListener(()=>{console.error("Background port disconnected unexpectedly.",chrome.runtime.lastError||"(No error info)"),!e.textContent.includes("Done")&&!e.textContent.includes("Error")&&(e.textContent="Disconnect Error",setTimeout(()=>{e.textContent="",e.innerHTML=s,e.disabled=!1},3e3))}),console.log("Sending message via port..."),T.postMessage({action:"generateAltText",imageUrl:E,isVideo:D}),console.log("Message sent via port.")}catch(T){console.error("Error establishing connection or posting initial message:",T),e.textContent="Connect Error",setTimeout(()=>{e.textContent="",e.innerHTML=s,e.disabled=!1},2e3)}};e.onclick=async u=>{u.preventDefault(),u.stopPropagation(),console.log("Generate Alt Text button clicked"),await L()};const m=o.parentNode;m?(console.log("Attempting to append button container to parent:",m),m.appendChild(a)):console.error("Could not find parent node to append button to."),o.dataset.geminiButtonAdded="true",console.log("Button insertion attempted. Check the DOM.")}const V=()=>{new MutationObserver(i=>{for(const a of i)a.type==="childList"&&a.addedNodes.forEach(e=>{var s;if(e.nodeType===Node.ELEMENT_NODE){const c=e;if((c.tagName==="IMG"||c.tagName==="VIDEO")&&!((s=c.getAttribute("alt"))!=null&&s.includes("avatar"))&&(console.log("Media element detected:",c),r.autoMode)){const g=c.closest('[data-testid="composer"], [role="dialog"], .css-175oi2r');g&&setTimeout(()=>{const L=g.querySelector(t);if(L){p(L);const m=g.querySelector(`#${n}`);m&&!m.disabled&&(console.log("Auto-generating alt text for newly added media"),m.click())}else{console.log("No alt text field found for auto-generation");const m=new MutationObserver(k=>{for(const N of k)if(N.type==="childList"){const u=g.querySelector(t);if(u){p(u);const E=g.querySelector(`#${n}`);E&&!E.disabled&&(console.log("Alt text field found after waiting, auto-generating"),E.click(),m.disconnect())}}});m.observe(g,{childList:!0,subtree:!0}),setTimeout(()=>m.disconnect(),5e3)}},500)}}})}).observe(document.body,{childList:!0,subtree:!0})};document.querySelectorAll(t).forEach(o=>{p(o)}),new MutationObserver(o=>{console.log("MutationObserver callback triggered.");for(const i of o)i.type==="childList"&&i.addedNodes.forEach(a=>{if(a.nodeType===Node.ELEMENT_NODE){const e=a;e.matches&&e.matches(t)?(console.log("Observer found matching textarea directly:",e),p(e)):e.querySelectorAll&&e.querySelectorAll(t).forEach(s=>{console.log("Observer found matching textarea within added node:",s),p(s)})}})}).observe(document.body,{childList:!0,subtree:!0}),V()}},C=(B=(q=globalThis.browser)==null?void 0:q.runtime)!=null&&B.id?globalThis.browser:globalThis.chrome;function S(l,...t){}const R={debug:(...l)=>S(console.debug,...l),log:(...l)=>S(console.log,...l),warn:(...l)=>S(console.warn,...l),error:(...l)=>S(console.error,...l)},A=class A extends Event{constructor(t,n){super(A.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};y(A,"EVENT_NAME",O("wxt:locationchange"));let _=A;function O(l){var t;return`${(t=C==null?void 0:C.runtime)==null?void 0:t.id}:bsky_alt_generator:${l}`}function $(l){let t,n;return{run(){t==null&&(n=new URL(location.href),t=l.setInterval(()=>{let r=new URL(location.href);r.href!==n.href&&(window.dispatchEvent(new _(r,n)),n=r)},1e3))}}}const w=class w{constructor(t,n){y(this,"isTopFrame",window.self===window.top);y(this,"abortController");y(this,"locationWatcher",$(this));y(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return C.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const r=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(t,n){const r=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(t){const n=requestAnimationFrame((...r)=>{this.isValid&&t(...r)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const r=requestIdleCallback((...d)=>{this.signal.aborted||t(...d)},n);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(t,n,r,d){var f;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(f=t.addEventListener)==null||f.call(t,n.startsWith("wxt:")?O(n):n,r,{...d,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),R.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:w.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var f,I,p;const n=((f=t.data)==null?void 0:f.type)===w.SCRIPT_STARTED_MESSAGE_TYPE,r=((I=t.data)==null?void 0:I.contentScriptName)===this.contentScriptName,d=!this.receivedMessageIds.has((p=t.data)==null?void 0:p.messageId);return n&&r&&d}listenForNewerScripts(t){let n=!0;const r=d=>{if(this.verifyScriptStartedEvent(d)){this.receivedMessageIds.add(d.data.messageId);const f=n;if(n=!1,f&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};y(w,"SCRIPT_STARTED_MESSAGE_TYPE",O("wxt:content-script-started"));let P=w;function H(){}function M(l,...t){}const F={debug:(...l)=>M(console.debug,...l),log:(...l)=>M(console.log,...l),warn:(...l)=>M(console.warn,...l),error:(...l)=>M(console.error,...l)};return(async()=>{try{const{main:l,...t}=h,n=new P("bsky_alt_generator",t);return await l(n)}catch(l){throw F.error('The content script "bsky_alt_generator" crashed on startup!',l),l}})()}();
bskyaltgenerator;
