var bskyaltgenerator=function(){"use strict";var L=Object.defineProperty;var _=(u,a,m)=>a in u?L(u,a,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[a]=m;var d=(u,a,m)=>_(u,typeof a!="symbol"?a+"":a,m);var S,C;function u(o){return o}const a={matches:["*://*.bsky.app/*"],main(){if(console.log("Bluesky Alt Text Generator loaded"),typeof window>"u"||typeof document>"u")return;const o='textarea[aria-label="Alt text"]',t="gemini-alt-text-button";function n(i){var f,A;if(console.log("addGenerateButton called for textarea:",i),i.dataset.geminiButtonAdded==="true"){console.log("Button already added to this textarea, skipping.");return}let s=i.closest('div[data-testid="composer"]');if(s?console.log("Found container via closest():",s):(s=(A=(f=i.parentElement)==null?void 0:f.parentElement)==null?void 0:A.parentElement,console.log("Using fallback container:",s)),!s){console.error("Could not find a suitable container for the button near textarea:",i);return}if(s.querySelector(`#${t}`)){console.log("Button already exists in this container, skipping.");return}const e=document.createElement("button");e.id=t,e.textContent="Gen Alt Text",e.style.marginLeft="8px",e.style.padding="2px 8px",e.style.fontSize="0.9em",e.style.cursor="pointer",e.style.border="1px solid #ccc",e.style.borderRadius="4px",e.style.backgroundColor="#f0f0f0",e.style.setProperty("display","inline-block","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("z-index","9999","important"),e.style.setProperty("position","relative","important"),console.log("Button element created:",e),e.onclick=async I=>{I.preventDefault(),I.stopPropagation(),console.log("Generate Alt Text button clicked"),e.textContent="Connecting...",e.disabled=!0;let T=document.querySelector("#root > div > div > div > div > div.css-175oi2r > div:nth-child(2) > div > div > div > div:nth-child(2) > div.css-175oi2r > div > div > img");if(console.log("Image found via specific selector:",T),!T||!T.src){console.error("Could not find image element or its src using specific selector."),e.textContent="Error: No Image",setTimeout(()=>{e.textContent="Gen Alt Text",e.disabled=!1},2e3);return}const k=T.src;console.log("Image URL:",k);try{console.log("Establishing connection to background script...");const g=chrome.runtime.connect({name:"altTextGenerator"});console.log("Connection established."),e.textContent="Generating...",g.onMessage.addListener(c=>{console.log("Message received from background via port:",c),c.altText?(i.value=c.altText,i.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),console.log("Alt text inserted."),e.textContent="âœ“ Done",setTimeout(()=>{e.textContent="Gen Alt Text",e.disabled=!1},1500)):c.error?(console.error("Error generating alt text:",c.error),e.textContent=`Error: ${c.error.substring(0,20)}...`,setTimeout(()=>{e.textContent="Gen Alt Text",e.disabled=!1},3e3)):(console.error("Received unexpected message format from background:",c),e.textContent="Msg Format Error",setTimeout(()=>{e.textContent="Gen Alt Text",e.disabled=!1},2e3)),g.disconnect()}),g.onDisconnect.addListener(()=>{console.error("Background port disconnected unexpectedly.",chrome.runtime.lastError||"(No error info)"),!e.textContent.includes("Done")&&!e.textContent.includes("Error")&&(e.textContent="Disconnect Error",setTimeout(()=>{e.textContent="Gen Alt Text",e.disabled=!1},3e3))}),console.log("Sending message via port..."),g.postMessage({action:"generateAltText",imageUrl:k}),console.log("Message sent via port.")}catch(g){console.error("Error establishing connection or posting initial message:",g),e.textContent="Connect Error",setTimeout(()=>{e.textContent="Gen Alt Text",e.disabled=!1},2e3)}};const l=i.parentNode;l?(console.log("Attempting to append button to parent:",l),l.appendChild(e)):console.error("Could not find parent node to append button to."),i.dataset.geminiButtonAdded="true",console.log("Button insertion attempted. Check the DOM.")}document.querySelectorAll(o).forEach(i=>{n(i)}),new MutationObserver(i=>{console.log("MutationObserver callback triggered.");for(const s of i)s.type==="childList"&&s.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const l=e;l.matches&&l.matches(o)?(console.log("Observer found matching textarea directly:",l),n(l)):l.querySelectorAll&&l.querySelectorAll(o).forEach(f=>{console.log("Observer found matching textarea within added node:",f),n(f)})}})}).observe(document.body,{childList:!0,subtree:!0}),console.log("Alt text generator initialized and watching for textareas")}},p=(C=(S=globalThis.browser)==null?void 0:S.runtime)!=null&&C.id?globalThis.browser:globalThis.chrome;function b(o,...t){}const N={debug:(...o)=>b(console.debug,...o),log:(...o)=>b(console.log,...o),warn:(...o)=>b(console.warn,...o),error:(...o)=>b(console.error,...o)},E=class E extends Event{constructor(t,n){super(E.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};d(E,"EVENT_NAME",y("wxt:locationchange"));let x=E;function y(o){var t;return`${(t=p==null?void 0:p.runtime)==null?void 0:t.id}:bsky_alt_generator:${o}`}function M(o){let t,n;return{run(){t==null&&(n=new URL(location.href),t=o.setInterval(()=>{let r=new URL(location.href);r.href!==n.href&&(window.dispatchEvent(new x(r,n)),n=r)},1e3))}}}const h=class h{constructor(t,n){d(this,"isTopFrame",window.self===window.top);d(this,"abortController");d(this,"locationWatcher",M(this));d(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return p.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const r=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(t,n){const r=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(t){const n=requestAnimationFrame((...r)=>{this.isValid&&t(...r)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const r=requestIdleCallback((...i)=>{this.signal.aborted||t(...i)},n);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(t,n,r,i){var s;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(s=t.addEventListener)==null||s.call(t,n.startsWith("wxt:")?y(n):n,r,{...i,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),N.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:h.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var s,e,l;const n=((s=t.data)==null?void 0:s.type)===h.SCRIPT_STARTED_MESSAGE_TYPE,r=((e=t.data)==null?void 0:e.contentScriptName)===this.contentScriptName,i=!this.receivedMessageIds.has((l=t.data)==null?void 0:l.messageId);return n&&r&&i}listenForNewerScripts(t){let n=!0;const r=i=>{if(this.verifyScriptStartedEvent(i)){this.receivedMessageIds.add(i.data.messageId);const s=n;if(n=!1,s&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};d(h,"SCRIPT_STARTED_MESSAGE_TYPE",y("wxt:content-script-started"));let w=h;function F(){}function v(o,...t){}const G={debug:(...o)=>v(console.debug,...o),log:(...o)=>v(console.log,...o),warn:(...o)=>v(console.warn,...o),error:(...o)=>v(console.error,...o)};return(async()=>{try{const{main:o,...t}=a,n=new w("bsky_alt_generator",t);return await o(n)}catch(o){throw G.error('The content script "bsky_alt_generator" crashed on startup!',o),o}})()}();
bskyaltgenerator;
