var bskyaltgenerator=function(){"use strict";var P=Object.defineProperty;var U=(v,f,x)=>f in v?P(v,f,{enumerable:!0,configurable:!0,writable:!0,value:x}):v[f]=x;var y=(v,f,x)=>U(v,typeof f!="symbol"?f+"":f,x);var B,D;function v(s){return s}const f={matches:["*://*.bsky.app/*"],main(){if(console.log("Bluesky Alt Text Generator loaded"),typeof window>"u"||typeof document>"u")return;const t=['textarea[aria-label="Alt text"]','textarea[placeholder*="alt"]','textarea[placeholder*="Alt"]','textarea[data-testid*="alt"]','[role="textbox"][aria-label*="alt" i]'].join(","),o="gemini-alt-text-button";let n={autoMode:!1,showToasts:!0};chrome.storage.sync.get(["autoMode","showToasts"],r=>{r.autoMode!==void 0&&(n.autoMode=r.autoMode),r.showToasts!==void 0&&(n.showToasts=r.showToasts),console.log("Loaded config:",n)}),chrome.storage.onChanged.addListener(r=>{r.autoMode&&(n.autoMode=r.autoMode.newValue),r.showToasts&&(n.showToasts=r.showToasts.newValue),console.log("Updated config:",n)});const g=(r,c="info",l=5e3)=>{let e=document.getElementById("gemini-toast-container");e||(e=document.createElement("div"),e.id="gemini-toast-container",e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="10000",e.style.display="flex",e.style.flexDirection="column",e.style.gap="10px",document.body.appendChild(e));const i=document.createElement("div");i.style.padding="12px 16px",i.style.borderRadius="6px",i.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)",i.style.margin="5px",i.style.minWidth="200px",i.style.color="#ffffff",i.style.fontSize="14px",i.style.transition="all 0.3s ease",c==="success"?i.style.backgroundColor="#1da882":c==="error"?i.style.backgroundColor="#e53935":c==="warning"?i.style.backgroundColor="#f59f0b":i.style.backgroundColor="#007eda",i.textContent=r;const a=document.createElement("span");a.textContent="×",a.style.marginLeft="8px",a.style.cursor="pointer",a.style.float="right",a.style.fontWeight="bold",a.onclick=()=>{e.removeChild(i)},i.appendChild(a),e.appendChild(i),setTimeout(()=>{e.contains(i)&&e.removeChild(i)},l)},p=r=>r.querySelector('img[alt="Image preview"], img[data-testid="image-preview"], img:not([alt="avatar"])')||r.querySelector('video[data-testid="video-preview"], video')||r.querySelector(".css-175oi2r img, .image-preview img")||Array.from(r.querySelectorAll("img")).find(l=>l.src&&!l.src.includes("avatar")&&!l.src.includes("logo")&&l.width>50);function h(r){var k,N;if(console.log("addGenerateButton called for textarea:",r),r.dataset.geminiButtonAdded==="true"){console.log("Button already added to this textarea, skipping.");return}let c=r.closest('[data-testid="composer"], [role="dialog"], .css-175oi2r');if(c?console.log("Found container via closest():",c):(c=(N=(k=r.parentElement)==null?void 0:k.parentElement)==null?void 0:N.parentElement,console.log("Using fallback container:",c)),!c){console.error("Could not find a suitable container for the button near textarea:",r);return}if(c.querySelector(`#${o}`)){console.log("Button already exists in this container, skipping.");return}const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.marginLeft="8px";const e=document.createElement("button");e.id=o,e.title="Generate Alt Text",e.innerHTML=`
        <svg width="20" height="20" viewBox="-5 -10 128 128" xmlns="http://www.w3.org/2000/svg">
          <path d="M 35.746,4 C 20.973,4 9,15.973 9,30.746 V 77.254 C 9,92.027 20.973,104 35.746,104 H 82.254 C 97.027,104 109,92.027 109,77.254 V 30.746 C 109,15.973 97.027,4 82.254,4 Z m -19.77,26.746 c 0,-10.918 8.8516,-19.77 19.77,-19.77 h 46.508 c 10.918,0 19.77,8.8516 19.77,19.77 v 46.508 c 0,10.918 -8.8516,19.77 -19.77,19.77 H 35.746 c -10.918,0 -19.77,-8.8516 -19.77,-19.77 z m 45.609,0.37891 c -1.082,-2.1055 -4.0898,-2.1055 -5.1719,0 l -4.3242,8.4219 c -1.668,3.2383 -4.3047,5.875 -7.543,7.543 l -8.4219,4.3242 c -2.1055,1.082 -2.1055,4.0898 0,5.1719 l 8.4219,4.3242 c 3.2383,1.668 5.875,4.3047 7.543,7.543 l 4.3242,8.4219 c 1.082,2.1055 4.0898,2.1055 5.1719,0 l 4.3242,-8.4219 c 1.668,-3.2383 4.3047,-5.875 7.543,-7.543 l 8.4219,-4.3242 c 2.1055,-1.082 2.1055,-4.0898 0,-5.1719 l -8.4219,-4.3242 c -3.2383,-1.668 -5.875,-4.3047 -7.543,-7.543 z" 
             fill="#323248" stroke="none" />
        </svg>
      `,e.style.marginLeft="8px",e.style.padding="4px",e.style.cursor="pointer",e.style.border="1px solid #ccc",e.style.borderRadius="4px",e.style.backgroundColor="#f0f0f0",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.setProperty("visibility","visible","important"),e.style.setProperty("z-index","9999","important"),e.style.setProperty("position","relative","important"),console.log("Button element created:",e);const i=e.innerHTML,a=document.createElement("label");a.className="gemini-auto-toggle",a.title="Auto-generate alt text when media is added",a.style.display="flex",a.style.alignItems="center",a.style.fontSize="12px",a.style.cursor="pointer";const u=document.createElement("input");u.type="checkbox",u.style.margin="0 4px 0 0",u.checked=n.autoMode,u.addEventListener("change",d=>{n.autoMode=d.target.checked,chrome.storage.sync.set({autoMode:n.autoMode})}),a.appendChild(u),a.appendChild(document.createTextNode("Auto")),l.appendChild(e),l.appendChild(a);const I=async()=>{e.innerHTML="",e.textContent="Connecting...",e.disabled=!0;const d=p(c);if(console.log("Media element found:",d),!d||!d.src){console.error("Could not find media element or its src."),e.textContent="Error: No Media",setTimeout(()=>{e.textContent="",e.innerHTML=i,e.disabled=!1},2e3);return}const E=d.src,R=d.tagName.toLowerCase()==="video";console.log(`${R?"Video":"Image"} URL:`,E);try{console.log("Establishing connection to background script...");const T=chrome.runtime.connect({name:"altTextGenerator"});console.log("Connection established."),e.textContent="Generating...",T.onMessage.addListener(b=>{console.log("Message received from background via port:",b),b.altText?(r.value=b.altText,r.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),console.log("Alt text inserted."),e.textContent="✓ Done",n.showToasts&&g("Alt text generated! Please review for accuracy before posting.","success"),setTimeout(()=>{e.textContent="",e.innerHTML=i,e.disabled=!1},1500)):b.error?(console.error("Error generating alt text:",b.error),e.textContent=`Error: ${b.error.substring(0,20)}...`,n.showToasts&&g(`Error: ${b.error}`,"error"),setTimeout(()=>{e.textContent="",e.innerHTML=i,e.disabled=!1},3e3)):(console.error("Received unexpected message format from background:",b),e.textContent="Msg Format Error",setTimeout(()=>{e.textContent="",e.innerHTML=i,e.disabled=!1},2e3)),T.disconnect()}),T.onDisconnect.addListener(()=>{console.error("Background port disconnected unexpectedly.",chrome.runtime.lastError||"(No error info)"),!e.textContent.includes("Done")&&!e.textContent.includes("Error")&&(e.textContent="Disconnect Error",setTimeout(()=>{e.textContent="",e.innerHTML=i,e.disabled=!1},3e3))}),console.log("Sending message via port..."),T.postMessage({action:"generateAltText",imageUrl:E,isVideo:R}),console.log("Message sent via port.")}catch(T){console.error("Error establishing connection or posting initial message:",T),e.textContent="Connect Error",setTimeout(()=>{e.textContent="",e.innerHTML=i,e.disabled=!1},2e3)}};e.onclick=async d=>{d.preventDefault(),d.stopPropagation(),console.log("Generate Alt Text button clicked"),await I()};const m=r.parentNode;m?(console.log("Attempting to append button container to parent:",m),m.appendChild(l)):console.error("Could not find parent node to append button to."),r.dataset.geminiButtonAdded="true",console.log("Button insertion attempted. Check the DOM.")}const A=()=>{new MutationObserver(c=>{for(const l of c)l.type==="childList"&&l.addedNodes.forEach(e=>{var i;if(e.nodeType===Node.ELEMENT_NODE){const a=e;if((a.tagName==="IMG"||a.tagName==="VIDEO")&&!((i=a.getAttribute("alt"))!=null&&i.includes("avatar"))&&(console.log("Media element detected:",a),n.autoMode)){const u=a.closest('[data-testid="composer"], [role="dialog"], .css-175oi2r');u&&setTimeout(()=>{const I=u.querySelector(t);if(I){h(I);const m=u.querySelector(`#${o}`);m&&!m.disabled&&(console.log("Auto-generating alt text for newly added media"),m.click())}else{console.log("No alt text field found for auto-generation");const m=new MutationObserver(k=>{for(const N of k)if(N.type==="childList"){const d=u.querySelector(t);if(d){h(d);const E=u.querySelector(`#${o}`);E&&!E.disabled&&(console.log("Alt text field found after waiting, auto-generating"),E.click(),m.disconnect())}}});m.observe(u,{childList:!0,subtree:!0}),setTimeout(()=>m.disconnect(),5e3)}},500)}}})}).observe(document.body,{childList:!0,subtree:!0})};document.querySelectorAll(t).forEach(r=>{h(r)}),new MutationObserver(r=>{console.log("MutationObserver callback triggered.");for(const c of r)c.type==="childList"&&c.addedNodes.forEach(l=>{if(l.nodeType===Node.ELEMENT_NODE){const e=l;e.matches&&e.matches(t)?(console.log("Observer found matching textarea directly:",e),h(e)):e.querySelectorAll&&e.querySelectorAll(t).forEach(i=>{console.log("Observer found matching textarea within added node:",i),h(i)})}})}).observe(document.body,{childList:!0,subtree:!0}),A()}},C=(D=(B=globalThis.browser)==null?void 0:B.runtime)!=null&&D.id?globalThis.browser:globalThis.chrome;function S(s,...t){}const $={debug:(...s)=>S(console.debug,...s),log:(...s)=>S(console.log,...s),warn:(...s)=>S(console.warn,...s),error:(...s)=>S(console.error,...s)},L=class L extends Event{constructor(t,o){super(L.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=o}};y(L,"EVENT_NAME",O("wxt:locationchange"));let _=L;function O(s){var t;return`${(t=C==null?void 0:C.runtime)==null?void 0:t.id}:bsky_alt_generator:${s}`}function F(s){let t,o;return{run(){t==null&&(o=new URL(location.href),t=s.setInterval(()=>{let n=new URL(location.href);n.href!==o.href&&(window.dispatchEvent(new _(n,o)),o=n)},1e3))}}}const w=class w{constructor(t,o){y(this,"isTopFrame",window.self===window.top);y(this,"abortController");y(this,"locationWatcher",F(this));y(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=o,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return C.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,o){const n=setInterval(()=>{this.isValid&&t()},o);return this.onInvalidated(()=>clearInterval(n)),n}setTimeout(t,o){const n=setTimeout(()=>{this.isValid&&t()},o);return this.onInvalidated(()=>clearTimeout(n)),n}requestAnimationFrame(t){const o=requestAnimationFrame((...n)=>{this.isValid&&t(...n)});return this.onInvalidated(()=>cancelAnimationFrame(o)),o}requestIdleCallback(t,o){const n=requestIdleCallback((...g)=>{this.signal.aborted||t(...g)},o);return this.onInvalidated(()=>cancelIdleCallback(n)),n}addEventListener(t,o,n,g){var p;o==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(p=t.addEventListener)==null||p.call(t,o.startsWith("wxt:")?O(o):o,n,{...g,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),$.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:w.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var p,h,A;const o=((p=t.data)==null?void 0:p.type)===w.SCRIPT_STARTED_MESSAGE_TYPE,n=((h=t.data)==null?void 0:h.contentScriptName)===this.contentScriptName,g=!this.receivedMessageIds.has((A=t.data)==null?void 0:A.messageId);return o&&n&&g}listenForNewerScripts(t){let o=!0;const n=g=>{if(this.verifyScriptStartedEvent(g)){this.receivedMessageIds.add(g.data.messageId);const p=o;if(o=!1,p&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",n),this.onInvalidated(()=>removeEventListener("message",n))}};y(w,"SCRIPT_STARTED_MESSAGE_TYPE",O("wxt:content-script-started"));let q=w;function G(){}function M(s,...t){}const V={debug:(...s)=>M(console.debug,...s),log:(...s)=>M(console.log,...s),warn:(...s)=>M(console.warn,...s),error:(...s)=>M(console.error,...s)};return(async()=>{try{const{main:s,...t}=f,o=new q("bsky_alt_generator",t);return await s(o)}catch(s){throw V.error('The content script "bsky_alt_generator" crashed on startup!',s),s}})()}();
bskyaltgenerator;
