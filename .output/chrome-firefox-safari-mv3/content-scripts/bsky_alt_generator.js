var bskyaltgenerator=function(){"use strict";var B=Object.defineProperty;var U=(x,y,T)=>y in x?B(x,y,{enumerable:!0,configurable:!0,writable:!0,value:T}):x[y]=T;var E=(x,y,T)=>U(x,typeof y!="symbol"?y+"":y,T);var D,O;function x(c){return c}const y={matches:["*://*.bsky.app/*"],main(){if(console.log("Bluesky Alt Text Generator loaded"),typeof window>"u"||typeof document>"u")return;const t=['textarea[aria-label="Alt text"]','textarea[placeholder*="alt"]','textarea[placeholder*="Alt"]','textarea[data-testid*="alt"]','[role="textbox"][aria-label*="alt" i]'].join(","),a="gemini-alt-text-button";let l={autoMode:!1,showToasts:!0};const h={storage:{sync:{get:(o,s)=>{var i;try{(i=chrome==null?void 0:chrome.storage)!=null&&i.sync?chrome.storage.sync.get(o,s):(console.warn("Chrome storage API not available, using default values"),s({}))}catch(e){console.error("Error accessing chrome.storage.sync.get:",e),s({})}},set:o=>{var s;try{(s=chrome==null?void 0:chrome.storage)!=null&&s.sync?chrome.storage.sync.set(o):console.warn("Chrome storage API not available, cannot save settings")}catch(i){console.error("Error accessing chrome.storage.sync.set:",i)}}}},runtime:{connect:o=>{var s;try{if((s=chrome==null?void 0:chrome.runtime)!=null&&s.connect)return chrome.runtime.connect(o);throw console.error("Chrome runtime API not available"),new Error("Chrome runtime API not available")}catch(i){throw console.error("Error connecting to background script:",i),i}},onChanged:{addListener:o=>{var s;try{(s=chrome==null?void 0:chrome.storage)!=null&&s.onChanged?chrome.storage.onChanged.addListener(o):console.warn("Chrome storage.onChanged API not available")}catch(i){console.error("Error adding onChanged listener:",i)}}}}};h.storage.sync.get(["autoMode","showToasts"],o=>{o.autoMode!==void 0&&(l.autoMode=o.autoMode),o.showToasts!==void 0&&(l.showToasts=o.showToasts),console.log("Loaded config:",l)}),h.runtime.onChanged.addListener(o=>{o.autoMode&&(l.autoMode=o.autoMode.newValue),o.showToasts&&(l.showToasts=o.showToasts.newValue),console.log("Updated config:",l)});const b=(o,s="info",i=5e3)=>{let e=document.getElementById("gemini-toast-container");e||(e=document.createElement("div"),e.id="gemini-toast-container",e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="10000",e.style.display="flex",e.style.flexDirection="column",e.style.gap="10px",document.body.appendChild(e));const n=document.createElement("div");n.style.padding="12px 16px",n.style.borderRadius="6px",n.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)",n.style.margin="5px",n.style.minWidth="200px",n.style.color="#ffffff",n.style.fontSize="14px",n.style.transition="all 0.3s ease",s==="success"?n.style.backgroundColor="#1da882":s==="error"?n.style.backgroundColor="#e53935":s==="warning"?n.style.backgroundColor="#f59f0b":n.style.backgroundColor="#007eda",n.textContent=o;const r=document.createElement("span");r.textContent="×",r.style.marginLeft="8px",r.style.cursor="pointer",r.style.float="right",r.style.fontWeight="bold",r.onclick=()=>{e.removeChild(n)},n.appendChild(r),e.appendChild(n),setTimeout(()=>{e.contains(n)&&e.removeChild(n)},i)},k=o=>{console.log("Searching for media in container:",o);const s=Array.from(o.querySelectorAll("img, video"));console.log(`Found ${s.length} initial candidates (img/video) in container.`);let i=null,e=-1;for(const n of s){let r=0;const d=n.getBoundingClientRect();if(!(d.width===0||d.height===0||n.offsetParent===null)){if(n.tagName==="VIDEO")if(n.src||n.querySelector("source[src]"))console.log("Found video candidate:",n),r=1e3;else continue;else{const g=n,u=g.src||"",m=g.alt||"";if(!u||u.startsWith("data:")||m.toLowerCase().includes("avatar")||u.includes("avatar")||u.includes("profile"))continue;const w=50;if(d.width<w||d.height<w)continue;r=1,console.log(`Valid image candidate found: ${d.width}x${d.height}`,g),g.closest('[data-testid="imagePreview"], .r-1p0dtai[style*="aspect-ratio"]')&&(console.log("Image is inside a high-priority preview wrapper, boosting score significantly."),r+=500),r<=1&&g.matches('[data-testid*="image"], [data-testid*="preview"], [role="img"]')&&(console.log("Image has a relevant test ID/role, boosting score."),r+=50);const f=g.closest('[data-testid="postView"], [role="article"]'),p=o.closest('[data-testid="postView"], [role="article"]');f&&p&&f!==p&&(console.log("Image seems to be inside a *different* post structure, penalizing score."),r=Math.max(0,r-100)),r+=Math.min(5,Math.floor(d.width/100))}console.log("Candidate score:",r,n),r>e&&(e=r,i=n,console.log("New best candidate selected with score:",e,i))}}return i?console.log("Final selected best candidate:",i):console.error("Failed to find a suitable media candidate within the container after scoring (Highest score <= 0)."),i};function v(o){if(console.log("addGenerateButton called for textarea:",o),o.dataset.geminiButtonAdded==="true"){console.log("Button already added to this textarea, skipping.");return}let s=V(o);if(!s){console.error("Could not find a suitable container for the button near textarea:",o);return}if(console.log("Found container:",s),s.querySelector(`#${a}`)){console.log("Button already exists in this container, skipping.");return}const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.gap="8px",i.style.marginLeft="8px";const e=document.createElement("button");e.id=a,e.title="Generate Alt Text",e.innerHTML=`
        <svg width="20" height="20" viewBox="-5 -10 128 128" xmlns="http://www.w3.org/2000/svg">
          <path d="M 35.746,4 C 20.973,4 9,15.973 9,30.746 V 77.254 C 9,92.027 20.973,104 35.746,104 H 82.254 C 97.027,104 109,92.027 109,77.254 V 30.746 C 109,15.973 97.027,4 82.254,4 Z m -19.77,26.746 c 0,-10.918 8.8516,-19.77 19.77,-19.77 h 46.508 c 10.918,0 19.77,8.8516 19.77,19.77 v 46.508 c 0,10.918 -8.8516,19.77 -19.77,19.77 H 35.746 c -10.918,0 -19.77,-8.8516 -19.77,-19.77 z m 45.609,0.37891 c -1.082,-2.1055 -4.0898,-2.1055 -5.1719,0 l -4.3242,8.4219 c -1.668,3.2383 -4.3047,5.875 -7.543,7.543 l -8.4219,4.3242 c -2.1055,1.082 -2.1055,4.0898 0,5.1719 l 8.4219,4.3242 c 3.2383,1.668 5.875,4.3047 7.543,7.543 l 4.3242,8.4219 c 1.082,2.1055 4.0898,2.1055 5.1719,0 l 4.3242,-8.4219 c 1.668,-3.2383 4.3047,-5.875 7.543,-7.543 l 8.4219,-4.3242 c 2.1055,-1.082 2.1055,-4.0898 0,-5.1719 l -8.4219,-4.3242 c -3.2383,-1.668 -5.875,-4.3047 -7.543,-7.543 z" 
             fill="#323248" stroke="none" />
        </svg>
      `,e.style.marginLeft="8px",e.style.padding="4px",e.style.cursor="pointer",e.style.border="1px solid #ccc",e.style.borderRadius="4px",e.style.backgroundColor="#f0f0f0",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.setProperty("visibility","visible","important"),e.style.setProperty("z-index","9999","important"),e.style.setProperty("position","relative","important"),console.log("Button element created:",e);const n=e.innerHTML,r=document.createElement("label");r.className="gemini-auto-toggle",r.title="Auto-generate alt text when media is added",r.style.display="flex",r.style.alignItems="center",r.style.fontSize="12px",r.style.cursor="pointer";const d=document.createElement("input");d.type="checkbox",d.style.margin="0 4px 0 0",d.checked=l.autoMode,d.addEventListener("change",m=>{l.autoMode=m.target.checked,h.storage.sync.set({autoMode:l.autoMode})}),r.appendChild(d),r.appendChild(document.createTextNode("Auto")),i.appendChild(e),i.appendChild(r);const g=async()=>{e.innerHTML="",e.textContent="Connecting...",e.disabled=!0;const m=k(s);if(console.log("Media element found:",m),!m||!m.src){console.error("Could not find media element or its src."),e.textContent="Error: No Media",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},2e3);return}const w=m.src,C=m.tagName.toLowerCase()==="video";console.log(`${C?"Video":"Image"} URL:`,w);try{console.log("Establishing connection to background script...");const f=h.runtime.connect({name:"altTextGenerator"});console.log("Connection established."),e.textContent="Generating...",f.onMessage.addListener(p=>{console.log("Message received from background via port:",p),p.altText?(o.value=p.altText,o.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),console.log("Alt text inserted."),e.textContent="✓ Done",l.showToasts&&b("Alt text generated! Please review for accuracy before posting.","success"),setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},1500)):p.error?(console.error("Error generating alt text:",p.error),e.textContent=`Error: ${p.error.substring(0,20)}...`,l.showToasts&&b(`Error: ${p.error}`,"error"),setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},3e3)):(console.error("Received unexpected message format from background:",p),e.textContent="Msg Format Error",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},2e3)),f.disconnect()}),f.onDisconnect.addListener(()=>{console.error("Background port disconnected unexpectedly.",chrome.runtime.lastError||"(No error info)"),!e.textContent.includes("Done")&&!e.textContent.includes("Error")&&(e.textContent="Disconnect Error",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},3e3))}),console.log("Sending message via port..."),f.postMessage({action:"generateAltText",imageUrl:w,isVideo:C}),console.log("Message sent via port.")}catch(f){console.error("Error establishing connection or posting initial message:",f),e.textContent="Connect Error",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},2e3)}};e.onclick=async m=>{m.preventDefault(),m.stopPropagation(),console.log("Generate Alt Text button clicked"),await g()};const u=o.parentNode;u?(console.log("Attempting to append button container to parent:",u),u.appendChild(i)):console.error("Could not find parent node to append button to."),o.dataset.geminiButtonAdded="true",console.log("Button insertion attempted. Check the DOM.")}function V(o){var r,d;console.log("Finding composer container for element:",o);const s=o.closest('[role="dialog"][aria-modal="true"]');if(s)return console.log("Found modal dialog container:",s),s.querySelector('[data-testid*="image"], [role="img"], .r-1p0dtai')?(console.log("Modal dialog contains an image area, returning it."),s):(console.warn("Modal dialog found, but no image area detected within it. Returning dialog anyway."),s);const i=o.closest('[data-testid="composer"]');if(i){if(console.log('Found container via data-testid="composer":',i),i.querySelector('button[aria-label*="Post"], button[type="submit"]'))return console.log("Composer with test ID seems valid."),i;console.warn('Found data-testid="composer", but it lacks expected elements. Continuing search...')}console.log("Modal or testid composer not found directly. Walking up DOM...");let e=o.parentElement,n=10;for(;e&&e.tagName!=="BODY"&&n>0;){const g=!!e.querySelector('[data-testid*="image"] img, .r-1p0dtai img, [role="img"] img, video'),u=e.matches('.css-175oi2r, [role="article"], [style*="flex-direction"]');if(g&&u)return console.log("Found plausible container with media preview by walking up:",e),e;n--,e=e.parentElement}return console.error("Could not reliably determine the composer container. Using fallback parent."),((d=(r=o.parentElement)==null?void 0:r.parentElement)==null?void 0:d.parentElement)||o.parentElement}const $=()=>{new MutationObserver(s=>{for(const i of s)i.type==="childList"&&i.addedNodes.forEach(e=>{var n;if(e.nodeType===Node.ELEMENT_NODE){const r=e;if((r.tagName==="IMG"||r.tagName==="VIDEO")&&!((n=r.getAttribute("alt"))!=null&&n.includes("avatar"))&&(console.log("Media element detected:",r),l.autoMode)){const d=r.closest('[data-testid="composer"], [role="dialog"], .css-175oi2r');d&&setTimeout(()=>{const g=d.querySelector(t);if(g){v(g);const u=d.querySelector(`#${a}`);u&&!u.disabled&&(console.log("Auto-generating alt text for newly added media"),u.click())}else{console.log("No alt text field found for auto-generation");const u=new MutationObserver(m=>{for(const w of m)if(w.type==="childList"){const C=d.querySelector(t);if(C){v(C);const f=d.querySelector(`#${a}`);f&&!f.disabled&&(console.log("Alt text field found after waiting, auto-generating"),f.click(),u.disconnect())}}});u.observe(d,{childList:!0,subtree:!0}),setTimeout(()=>u.disconnect(),5e3)}},500)}}})}).observe(document.body,{childList:!0,subtree:!0})};document.querySelectorAll(t).forEach(o=>{v(o)}),new MutationObserver(o=>{console.log("MutationObserver callback triggered.");for(const s of o)s.type==="childList"&&s.addedNodes.forEach(i=>{if(i.nodeType===Node.ELEMENT_NODE){const e=i;e.matches&&e.matches(t)?(console.log("Observer found matching textarea directly:",e),v(e)):e.querySelectorAll&&e.querySelectorAll(t).forEach(n=>{console.log("Observer found matching textarea within added node:",n),v(n)})}})}).observe(document.body,{childList:!0,subtree:!0}),$()}},S=(O=(D=globalThis.browser)==null?void 0:D.runtime)!=null&&O.id?globalThis.browser:globalThis.chrome;function I(c,...t){}const _={debug:(...c)=>I(console.debug,...c),log:(...c)=>I(console.log,...c),warn:(...c)=>I(console.warn,...c),error:(...c)=>I(console.error,...c)},L=class L extends Event{constructor(t,a){super(L.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=a}};E(L,"EVENT_NAME",P("wxt:locationchange"));let N=L;function P(c){var t;return`${(t=S==null?void 0:S.runtime)==null?void 0:t.id}:bsky_alt_generator:${c}`}function q(c){let t,a;return{run(){t==null&&(a=new URL(location.href),t=c.setInterval(()=>{let l=new URL(location.href);l.href!==a.href&&(window.dispatchEvent(new N(l,a)),a=l)},1e3))}}}const M=class M{constructor(t,a){E(this,"isTopFrame",window.self===window.top);E(this,"abortController");E(this,"locationWatcher",q(this));E(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=a,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return S.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,a){const l=setInterval(()=>{this.isValid&&t()},a);return this.onInvalidated(()=>clearInterval(l)),l}setTimeout(t,a){const l=setTimeout(()=>{this.isValid&&t()},a);return this.onInvalidated(()=>clearTimeout(l)),l}requestAnimationFrame(t){const a=requestAnimationFrame((...l)=>{this.isValid&&t(...l)});return this.onInvalidated(()=>cancelAnimationFrame(a)),a}requestIdleCallback(t,a){const l=requestIdleCallback((...h)=>{this.signal.aborted||t(...h)},a);return this.onInvalidated(()=>cancelIdleCallback(l)),l}addEventListener(t,a,l,h){var b;a==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(b=t.addEventListener)==null||b.call(t,a.startsWith("wxt:")?P(a):a,l,{...h,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),_.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:M.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var b,k,v;const a=((b=t.data)==null?void 0:b.type)===M.SCRIPT_STARTED_MESSAGE_TYPE,l=((k=t.data)==null?void 0:k.contentScriptName)===this.contentScriptName,h=!this.receivedMessageIds.has((v=t.data)==null?void 0:v.messageId);return a&&l&&h}listenForNewerScripts(t){let a=!0;const l=h=>{if(this.verifyScriptStartedEvent(h)){this.receivedMessageIds.add(h.data.messageId);const b=a;if(a=!1,b&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",l),this.onInvalidated(()=>removeEventListener("message",l))}};E(M,"SCRIPT_STARTED_MESSAGE_TYPE",P("wxt:content-script-started"));let F=M;function H(){}function A(c,...t){}const R={debug:(...c)=>A(console.debug,...c),log:(...c)=>A(console.log,...c),warn:(...c)=>A(console.warn,...c),error:(...c)=>A(console.error,...c)};return(async()=>{try{const{main:c,...t}=y,a=new F("bsky_alt_generator",t);return await c(a)}catch(c){throw R.error('The content script "bsky_alt_generator" crashed on startup!',c),c}})()}();
bskyaltgenerator;
