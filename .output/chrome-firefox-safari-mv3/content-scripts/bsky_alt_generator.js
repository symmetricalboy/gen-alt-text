var bskyaltgenerator=function(){"use strict";var $=Object.defineProperty;var G=(C,v,T)=>v in C?$(C,v,{enumerable:!0,configurable:!0,writable:!0,value:T}):C[v]=T;var x=(C,v,T)=>G(C,typeof v!="symbol"?v+"":v,T);var _,O;function C(c){return c}const v={matches:["*://*.bsky.app/*"],main(){if(console.log("Bluesky Alt Text Generator loaded"),typeof window>"u"||typeof document>"u")return;const r=['textarea[aria-label="Alt text"]','textarea[placeholder*="alt"]','textarea[placeholder*="Alt"]','textarea[data-testid*="alt"]','[role="textbox"][aria-label*="alt" i]'].join(","),i="gemini-alt-text-button";let a={autoMode:!1,showToasts:!0};const m={storage:{sync:{get:(t,l)=>{var o;try{(o=chrome==null?void 0:chrome.storage)!=null&&o.sync?chrome.storage.sync.get(t,l):(console.warn("Chrome storage API not available, using default values"),l({}))}catch(e){console.error("Error accessing chrome.storage.sync.get:",e),l({})}},set:t=>{var l;try{(l=chrome==null?void 0:chrome.storage)!=null&&l.sync?chrome.storage.sync.set(t):console.warn("Chrome storage API not available, cannot save settings")}catch(o){console.error("Error accessing chrome.storage.sync.set:",o)}}}},runtime:{connect:t=>{var l;try{if((l=chrome==null?void 0:chrome.runtime)!=null&&l.connect)return chrome.runtime.connect(t);throw console.error("Chrome runtime API not available"),new Error("Chrome runtime API not available")}catch(o){throw console.error("Error connecting to background script:",o),o}},onChanged:{addListener:t=>{var l;try{(l=chrome==null?void 0:chrome.storage)!=null&&l.onChanged?chrome.storage.onChanged.addListener(t):console.warn("Chrome storage.onChanged API not available")}catch(o){console.error("Error adding onChanged listener:",o)}}}}};m.storage.sync.get(["autoMode","showToasts"],t=>{t.autoMode!==void 0&&(a.autoMode=t.autoMode),t.showToasts!==void 0&&(a.showToasts=t.showToasts),console.log("Loaded config:",a)}),m.runtime.onChanged.addListener(t=>{t.autoMode&&(a.autoMode=t.autoMode.newValue),t.showToasts&&(a.showToasts=t.showToasts.newValue),console.log("Updated config:",a)});const y=(t,l="info",o=5e3)=>{let e=document.getElementById("gemini-toast-container");e||(e=document.createElement("div"),e.id="gemini-toast-container",e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="10000",e.style.display="flex",e.style.flexDirection="column",e.style.gap="10px",document.body.appendChild(e));const n=document.createElement("div");n.style.padding="12px 16px",n.style.borderRadius="6px",n.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)",n.style.margin="5px",n.style.minWidth="200px",n.style.color="#ffffff",n.style.fontSize="14px",n.style.transition="all 0.3s ease",l==="success"?n.style.backgroundColor="#1da882":l==="error"?n.style.backgroundColor="#e53935":l==="warning"?n.style.backgroundColor="#f59f0b":n.style.backgroundColor="#007eda",n.textContent=t;const s=document.createElement("span");s.textContent="×",s.style.marginLeft="8px",s.style.cursor="pointer",s.style.float="right",s.style.fontWeight="bold",s.onclick=()=>{e.removeChild(n)},n.appendChild(s),e.appendChild(n),setTimeout(()=>{e.contains(n)&&e.removeChild(n)},o)},k=t=>{console.log("Searching for media in container:",t);const l=t.querySelectorAll('[data-testid="imagePreview"], [data-testid="images"], .r-1p0dtai, [role="img"], .css-175oi2r > div > img');console.log("Found potential media containers:",l.length);for(const e of l){console.log("Checking media container:",e);const n=e.querySelector('img:not([alt="avatar"])')||e.querySelector("video");if(e.tagName==="IMG"||e.tagName==="VIDEO")return console.log("Container itself is a media element:",e),e;if(n)return console.log("Found media element within container:",n),n}const o=t.querySelector('img[alt="Image preview"], img[data-testid="image-preview"], img:not([alt="avatar"])')||t.querySelector('video[data-testid="video-preview"], video')||t.querySelector(".css-175oi2r img, .image-preview img")||t.querySelector('.r-1p0dtai img, [role="img"] img')||Array.from(t.querySelectorAll("img")).find(e=>{const n=e.src||"",s=e.alt||"",u=parseInt(e.getAttribute("width")||e.style.width||"0"),h=window.getComputedStyle(e),g=parseInt(h.width)||0,d=u>60||g>60||e.width>60,b=!s.includes("avatar")&&!n.includes("avatar")&&!n.includes("profile"),p=d&&b&&n;return p&&console.log("Found potential content image by size/source filtering:",e),p});if(!o){const e=t.closest('[data-testid="postView"]')||t.closest('[role="article"]')||t;console.log("Expanding search to post container:",e);const n=Array.from(e.querySelectorAll("img")).filter(s=>{var p,f;if(!s.src)return!1;const u=Array.from(s.classList).join(" "),h=Array.from(((p=s.parentElement)==null?void 0:p.classList)||[]).join(" "),g=s.width>100||s.height>100||h.includes("r-1p0dtai")||u.includes("r-1p0dtai"),d=!((f=s.alt)!=null&&f.includes("avatar"))&&!s.src.includes("avatar_thumbnail")&&!s.src.includes("profile"),b=g&&d;return b&&console.log("Found post image:",s),b});if(n.length>0)return console.log("Found image in expanded search:",n[0]),n[0]}return o};function E(t){if(console.log("addGenerateButton called for textarea:",t),t.dataset.geminiButtonAdded==="true"){console.log("Button already added to this textarea, skipping.");return}let l=V(t);if(!l){console.error("Could not find a suitable container for the button near textarea:",t);return}if(console.log("Found container:",l),l.querySelector(`#${i}`)){console.log("Button already exists in this container, skipping.");return}const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.gap="8px",o.style.marginLeft="8px";const e=document.createElement("button");e.id=i,e.title="Generate Alt Text",e.innerHTML=`
        <svg width="20" height="20" viewBox="-5 -10 128 128" xmlns="http://www.w3.org/2000/svg">
          <path d="M 35.746,4 C 20.973,4 9,15.973 9,30.746 V 77.254 C 9,92.027 20.973,104 35.746,104 H 82.254 C 97.027,104 109,92.027 109,77.254 V 30.746 C 109,15.973 97.027,4 82.254,4 Z m -19.77,26.746 c 0,-10.918 8.8516,-19.77 19.77,-19.77 h 46.508 c 10.918,0 19.77,8.8516 19.77,19.77 v 46.508 c 0,10.918 -8.8516,19.77 -19.77,19.77 H 35.746 c -10.918,0 -19.77,-8.8516 -19.77,-19.77 z m 45.609,0.37891 c -1.082,-2.1055 -4.0898,-2.1055 -5.1719,0 l -4.3242,8.4219 c -1.668,3.2383 -4.3047,5.875 -7.543,7.543 l -8.4219,4.3242 c -2.1055,1.082 -2.1055,4.0898 0,5.1719 l 8.4219,4.3242 c 3.2383,1.668 5.875,4.3047 7.543,7.543 l 4.3242,8.4219 c 1.082,2.1055 4.0898,2.1055 5.1719,0 l 4.3242,-8.4219 c 1.668,-3.2383 4.3047,-5.875 7.543,-7.543 l 8.4219,-4.3242 c 2.1055,-1.082 2.1055,-4.0898 0,-5.1719 l -8.4219,-4.3242 c -3.2383,-1.668 -5.875,-4.3047 -7.543,-7.543 z" 
             fill="#323248" stroke="none" />
        </svg>
      `,e.style.marginLeft="8px",e.style.padding="4px",e.style.cursor="pointer",e.style.border="1px solid #ccc",e.style.borderRadius="4px",e.style.backgroundColor="#f0f0f0",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.setProperty("visibility","visible","important"),e.style.setProperty("z-index","9999","important"),e.style.setProperty("position","relative","important"),console.log("Button element created:",e);const n=e.innerHTML,s=document.createElement("label");s.className="gemini-auto-toggle",s.title="Auto-generate alt text when media is added",s.style.display="flex",s.style.alignItems="center",s.style.fontSize="12px",s.style.cursor="pointer";const u=document.createElement("input");u.type="checkbox",u.style.margin="0 4px 0 0",u.checked=a.autoMode,u.addEventListener("change",d=>{a.autoMode=d.target.checked,m.storage.sync.set({autoMode:a.autoMode})}),s.appendChild(u),s.appendChild(document.createTextNode("Auto")),o.appendChild(e),o.appendChild(s);const h=async()=>{e.innerHTML="",e.textContent="Connecting...",e.disabled=!0;const d=k(l);if(console.log("Media element found:",d),!d||!d.src){console.error("Could not find media element or its src."),e.textContent="Error: No Media",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},2e3);return}const b=d.src,p=d.tagName.toLowerCase()==="video";console.log(`${p?"Video":"Image"} URL:`,b);try{console.log("Establishing connection to background script...");const f=m.runtime.connect({name:"altTextGenerator"});console.log("Connection established."),e.textContent="Generating...",f.onMessage.addListener(w=>{console.log("Message received from background via port:",w),w.altText?(t.value=w.altText,t.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),console.log("Alt text inserted."),e.textContent="✓ Done",a.showToasts&&y("Alt text generated! Please review for accuracy before posting.","success"),setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},1500)):w.error?(console.error("Error generating alt text:",w.error),e.textContent=`Error: ${w.error.substring(0,20)}...`,a.showToasts&&y(`Error: ${w.error}`,"error"),setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},3e3)):(console.error("Received unexpected message format from background:",w),e.textContent="Msg Format Error",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},2e3)),f.disconnect()}),f.onDisconnect.addListener(()=>{console.error("Background port disconnected unexpectedly.",chrome.runtime.lastError||"(No error info)"),!e.textContent.includes("Done")&&!e.textContent.includes("Error")&&(e.textContent="Disconnect Error",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},3e3))}),console.log("Sending message via port..."),f.postMessage({action:"generateAltText",imageUrl:b,isVideo:p}),console.log("Message sent via port.")}catch(f){console.error("Error establishing connection or posting initial message:",f),e.textContent="Connect Error",setTimeout(()=>{e.textContent="",e.innerHTML=n,e.disabled=!1},2e3)}};e.onclick=async d=>{d.preventDefault(),d.stopPropagation(),console.log("Generate Alt Text button clicked"),await h()};const g=t.parentNode;g?(console.log("Attempting to append button container to parent:",g),g.appendChild(o)):console.error("Could not find parent node to append button to."),t.dataset.geminiButtonAdded="true",console.log("Button insertion attempted. Check the DOM.")}function V(t){var s,u,h;console.log("Finding composer container for element:",t);const l=t.closest('[data-testid="composer"], [role="dialog"], .css-175oi2r');if(l)return console.log("Found container via closest() with attributes:",l),l;let o=t,e=10;for(;o&&o.tagName!=="BODY"&&e>0;){if(o.querySelector('[aria-label="Alt text"]')===t||o.getAttribute("role")==="dialog"||o.classList.contains("css-175oi2r")&&o.querySelector('button[aria-label="Close"], button[aria-label="Cancel"]')){console.log("Found potential alt text container:",o);const d=(s=o.parentElement)==null?void 0:s.closest('[data-testid="composer"], [role="article"]');return d?(console.log("Found composer from alt text container:",d),d):o}e--,o=o.parentElement}o=t;let n=null;for(let g=0;g<6&&!(!o||o.tagName==="BODY");g++)if(o=o.parentElement,o){const d=!!o.querySelector('button[aria-label="Post"], button[type="submit"]');if(o.getAttribute("role")==="dialog"||d||o.querySelector("textarea")||o.classList.contains("css-175oi2r")){n=o,console.log("Found likely composer parent:",n);break}}return n||((h=(u=t.parentElement)==null?void 0:u.parentElement)==null?void 0:h.parentElement)}const R=()=>{new MutationObserver(l=>{for(const o of l)o.type==="childList"&&o.addedNodes.forEach(e=>{var n;if(e.nodeType===Node.ELEMENT_NODE){const s=e;if((s.tagName==="IMG"||s.tagName==="VIDEO")&&!((n=s.getAttribute("alt"))!=null&&n.includes("avatar"))&&(console.log("Media element detected:",s),a.autoMode)){const u=s.closest('[data-testid="composer"], [role="dialog"], .css-175oi2r');u&&setTimeout(()=>{const h=u.querySelector(r);if(h){E(h);const g=u.querySelector(`#${i}`);g&&!g.disabled&&(console.log("Auto-generating alt text for newly added media"),g.click())}else{console.log("No alt text field found for auto-generation");const g=new MutationObserver(d=>{for(const b of d)if(b.type==="childList"){const p=u.querySelector(r);if(p){E(p);const f=u.querySelector(`#${i}`);f&&!f.disabled&&(console.log("Alt text field found after waiting, auto-generating"),f.click(),g.disconnect())}}});g.observe(u,{childList:!0,subtree:!0}),setTimeout(()=>g.disconnect(),5e3)}},500)}}})}).observe(document.body,{childList:!0,subtree:!0})};document.querySelectorAll(r).forEach(t=>{E(t)}),new MutationObserver(t=>{console.log("MutationObserver callback triggered.");for(const l of t)l.type==="childList"&&l.addedNodes.forEach(o=>{if(o.nodeType===Node.ELEMENT_NODE){const e=o;e.matches&&e.matches(r)?(console.log("Observer found matching textarea directly:",e),E(e)):e.querySelectorAll&&e.querySelectorAll(r).forEach(n=>{console.log("Observer found matching textarea within added node:",n),E(n)})}})}).observe(document.body,{childList:!0,subtree:!0}),R()}},A=(O=(_=globalThis.browser)==null?void 0:_.runtime)!=null&&O.id?globalThis.browser:globalThis.chrome;function M(c,...r){}const P={debug:(...c)=>M(console.debug,...c),log:(...c)=>M(console.log,...c),warn:(...c)=>M(console.warn,...c),error:(...c)=>M(console.error,...c)},I=class I extends Event{constructor(r,i){super(I.EVENT_NAME,{}),this.newUrl=r,this.oldUrl=i}};x(I,"EVENT_NAME",q("wxt:locationchange"));let N=I;function q(c){var r;return`${(r=A==null?void 0:A.runtime)==null?void 0:r.id}:bsky_alt_generator:${c}`}function D(c){let r,i;return{run(){r==null&&(i=new URL(location.href),r=c.setInterval(()=>{let a=new URL(location.href);a.href!==i.href&&(window.dispatchEvent(new N(a,i)),i=a)},1e3))}}}const S=class S{constructor(r,i){x(this,"isTopFrame",window.self===window.top);x(this,"abortController");x(this,"locationWatcher",D(this));x(this,"receivedMessageIds",new Set);this.contentScriptName=r,this.options=i,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(r){return this.abortController.abort(r)}get isInvalid(){return A.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(r){return this.signal.addEventListener("abort",r),()=>this.signal.removeEventListener("abort",r)}block(){return new Promise(()=>{})}setInterval(r,i){const a=setInterval(()=>{this.isValid&&r()},i);return this.onInvalidated(()=>clearInterval(a)),a}setTimeout(r,i){const a=setTimeout(()=>{this.isValid&&r()},i);return this.onInvalidated(()=>clearTimeout(a)),a}requestAnimationFrame(r){const i=requestAnimationFrame((...a)=>{this.isValid&&r(...a)});return this.onInvalidated(()=>cancelAnimationFrame(i)),i}requestIdleCallback(r,i){const a=requestIdleCallback((...m)=>{this.signal.aborted||r(...m)},i);return this.onInvalidated(()=>cancelIdleCallback(a)),a}addEventListener(r,i,a,m){var y;i==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(y=r.addEventListener)==null||y.call(r,i.startsWith("wxt:")?q(i):i,a,{...m,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),P.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:S.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(r){var y,k,E;const i=((y=r.data)==null?void 0:y.type)===S.SCRIPT_STARTED_MESSAGE_TYPE,a=((k=r.data)==null?void 0:k.contentScriptName)===this.contentScriptName,m=!this.receivedMessageIds.has((E=r.data)==null?void 0:E.messageId);return i&&a&&m}listenForNewerScripts(r){let i=!0;const a=m=>{if(this.verifyScriptStartedEvent(m)){this.receivedMessageIds.add(m.data.messageId);const y=i;if(i=!1,y&&(r!=null&&r.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",a),this.onInvalidated(()=>removeEventListener("message",a))}};x(S,"SCRIPT_STARTED_MESSAGE_TYPE",q("wxt:content-script-started"));let F=S;function U(){}function L(c,...r){}const B={debug:(...c)=>L(console.debug,...c),log:(...c)=>L(console.log,...c),warn:(...c)=>L(console.warn,...c),error:(...c)=>L(console.error,...c)};return(async()=>{try{const{main:c,...r}=v,i=new F("bsky_alt_generator",r);return await c(i)}catch(c){throw B.error('The content script "bsky_alt_generator" crashed on startup!',c),c}})()}();
bskyaltgenerator;
